<!DOCTYPE html>
<!--<html lang="en">-->
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">

<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Gestion des communes</title>-->
<!--    <link rel="stylesheet" href="/webjars/bootstrap/4.5.0/css/bootstrap.min.css"/>-->
<!--    <link rel="stylesheet" href="/webjars/font-awesome/4.7.0/css/font-awesome.css"/>-->
<!--    <script src="/webjars/jquery/3.5.1/jquery.min.js" type="application/javascript"></script>-->
<!--    <script src="/webjars/bootstrap/4.5.0/js/bootstrap.bundle.min.js" type="application/javascript"></script>-->
<!--</head>-->
<!--<head class="container" th:replace="common :: head">-->
<!--<head th:replace="fragments/header :: head(${title})"></head>-->
<head th:replace="fragments/header :: head('Gestion des communes')"></head>
<body>
<!--<div th:insert="fragments/header :: navbar"></div>-->
<div th:replace="fragments/header :: navbar('Gestion des communes', 'Liste des communes')"></div>
<!--<div>-->
<!--    <nav class="navbar navbar-expand-lg navbar-light bg-light">-->
<!--        <a class="navbar-brand" href="/">Gestion des Communes</a>-->
<!--        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">-->
<!--            <span class="navbar-toggler-icon"></span>-->
<!--        </button>-->

<!--        <div class="collapse navbar-collapse" id="navbarSupportedContent">-->
<!--            <ul class="navbar-nav mr-auto">-->
<!--                <li><a href="/" class="nav-link">Liste des communes <span class="badge badge-primary">29997</span></a></li>-->
<!--                <li></li>-->
<!--            </ul>-->

<!--            <form class="form-inline my-2 my-lg-0" role="search" action="/" method="GET">-->
<!--                <div class="form-group">-->
<!--                    <input name="search" value="" class="form-control" placeholder="Rechercher..." type="text">-->
<!--                </div>-->
<!--                <button type="submit" class="btn btn-outline-success ml-2 my-2 my-sm-0">Rechercher</button>-->
<!--            </form>-->
<!--            <a href="/login" class="btn btn-outline-success ml-2 my-2 my-sm-0">Se connecter</a>-->

<!--        </div>-->
<!--    </nav>-->
<!--</div>-->

<div>
    <div class="container">

<!--        <div th:if="${type}" th:class="|mt-1 alert alert-dismissible fade show alert-${type}|" role="alert">-->
<!--            <span th:utext="${message}"></span>-->
<!--            <button type="button" class="close" data-dismiss="alert" aria-label="Close">-->
<!--                <span aria-hidden="true">&times;</span>-->
<!--            </button>-->
<!--        </div>-->

        <div th:if="${type}" th:class="|mt-1 alert alert-dismissible fade show alert-${type}|" role="alert">
            <span th:utext="${message}"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

<!--        <div th:replace="fragments/header :: div_message"></div>-->
<!--        <div th:replace="fragments/header :: div_message(${type}, ${message})"></div>-->

        <!--        <h2>Détail de la commune [[${commune.codeInsee}]], Andert Et Condon</h2>-->
        <!--        <h2 th:unless="${newCommune}">Détail de la commune [[${commune.codeInsee}]], Andert Et Condon</h2>-->
        <h2 th:replace="fragments/header :: h2Detail"></h2>
        <!--        <h2 th:if="${newCommune}">Création d'une nouvelle commune</h2>-->
        <!--        <h2 th:replace="fragments/header :: h2('Création d'une nouvelle commune')"></h2>-->
        <h2 th:replace="fragments/header :: h2Crea"></h2>
        <div class="row">
            <div class="col-sm-12 col-lg-6">

                <!-- new commune -->
<!--                                <form id="saveForm" action="/communes/01009" method="post"><input type="hidden" name="_csrf" value="5652b6a4-4c3c-405d-a516-3666dd4b2de2"/>-->
                <!--                <form id="saveForm" action="/communes" method="post">-->
<!--                <form id="saveForm" th:action="@{|/communes/${commune.codeInsee}|}">-->
                <form id="saveForm" th:action="${newCommune} ? '/communes' : ('/communes/' + ${commune.codeInsee})" method="post"><input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <div class="mt-2">
<!--                        <div>-->
<!--                            <div class="form-group">-->
<!--                                <label for="codeInsee">Code INSEE</label>-->
<!--                                <input type="text" th:value="${commune.codeInsee}" class="form-control is-valid"-->
<!--                                       name="codeInsee"-->
<!--                                       id="codeInsee">-->
<!--                                &lt;!&ndash;                                <input th:unless="update" type="text" th:value="" class="form-control is-valid" name="codeInsee"&ndash;&gt;-->
<!--                                &lt;!&ndash;                                       id="codeInsee1">&ndash;&gt;-->
<!--                            </div>-->
<!--                        </div>-->

                        <div th:replace="fragments/champs :: champCodeInsee"></div>

<!--                        <div class="form-group">-->
<!--                            <label for="codeInsee">Code INSEE</label>-->
<!--                            <input type="text" th:value="${commune.codeInsee}"-->
<!--                                   th:class="|form-control ${#fields.hasErrors('commune.codeInsee') ? 'is-invalid' : 'is-valid'}|"-->
<!--                                   name="codeInsee"-->
<!--                                   id="codeInsee">-->
<!--                            <div class="invalid-feedback">-->
<!--                                <ul>-->
<!--                                    <li th:errors="${commune.codeInsee}"></li>-->
<!--                                </ul>-->
<!--                            </div>-->
<!--                        </div>-->

                        <!--                        <div>-->
                        <!--                            <div class="form-group">-->
                        <!--                                <label for="nom">Nom</label>-->

                        <!--                                <input type="text" th:value="${commune.nom}" class="form-control is-valid" name="nom"-->
                        <!--                                       id="nom">-->

                        <!--                            </div>-->
                        <!--                        </div>-->


                        <!--                    <div>-->
                        <!--                        <div class="form-group">-->
                        <!--                            <label for="nom">Nom</label>-->

                        <!--                            <input type="text" th:value="${commune.nom}" th:class="|form-control ${#fields.hasErrors('commune.nom'} ? 'is-invalid' :'is-valid'|" name="nom"-->
                        <!--                                   id="nom">-->
                        <!--                            <div class="invalid-feedback">-->
                        <!--                                <ul>-->
                        <!--                                    <li th:errors="${commune.nom}"></li>-->
                        <!--                                </ul>-->
                        <!--                            </div>-->
                        <!--                        </div>-->
                        <!--                    </div>-->

                        <div th:replace="fragments/champs :: champNom"></div>

<!--                        <div class="form-group">-->
<!--                            <label for="nom">Nom</label>-->
<!--                            <input type="text" th:value="${commune.nom}"-->
<!--                                   th:class="|form-control ${#fields.hasErrors('commune.nom') ? 'is-invalid' : 'is-valid'}|"-->
<!--                                   name="nom"-->
<!--                                   id="nom">-->
<!--                            <div class="invalid-feedback">-->
<!--                                <ul>-->
<!--                                    <li th:errors="${commune.nom}"></li>-->
<!--                                </ul>-->
<!--                            </div>-->
<!--                        </div>-->

<!--                        Avec error class-->
<!--                        <div class="form-group">-->
<!--                            <label for="nom">Nom</label>-->
<!--                            <input type="text" th:value="${commune.nom}"-->
<!--                                   th:errorclass="is-invalid"-->
<!--                                   th:class="is-valid"-->
<!--                                   name="nom"-->
<!--                                   id="nom">-->
<!--                            <div class="invalid-feedback">-->
<!--                                <ul>-->
<!--                                    <li th:errors="${commune.nom}"></li>-->
<!--                                </ul>-->
<!--                            </div>-->
<!--                        </div>-->

<!--                        <div>-->
<!--                            <div class="form-group">-->
<!--                                <label for="codePostal">Code Postal</label>-->

<!--                                <input type="text" th:value="${commune.codePostal}" class="form-control is-valid"-->
<!--                                       name="codePostal"-->
<!--                                       id="codePostal">-->

<!--                            </div>-->
<!--                        </div>-->

                        <div th:replace="fragments/champs :: champCodePostal"></div>

<!--                        <div class="form-group">-->
<!--                            <label for="codePostal">Code postal</label>-->
<!--                            <input type="text" th:value="${commune.codePostal}"-->
<!--                                   th:class="|form-control ${#fields.hasErrors('commune.codePostal') ? 'is-invalid' : 'is-valid'}|"-->
<!--                                   name="codePostal"-->
<!--                                   id="codePostal">-->
<!--                            <div class="invalid-feedback">-->
<!--                                <ul>-->
<!--                                    <li th:errors="${commune.codePostal}"></li>-->
<!--                                </ul>-->
<!--                            </div>-->
<!--                        </div>-->

<!--                        <div>-->
<!--                            <div class="form-group">-->
<!--                                <label for="latitude">Latitude</label>-->

<!--                                <input type="text" th:value="${commune.latitude}" class="form-control is-valid"-->
<!--                                       name="latitude"-->
<!--                                       id="latitude">-->

<!--                            </div>-->
<!--                        </div>-->

                        <div th:replace="fragments/champs :: champLatitude"></div>

<!--                        <div class="form-group">-->
<!--                            <label for="latitude">Latitude</label>-->
<!--                            <input type="text" th:value="${commune.latitude}"-->
<!--                                   th:class="|form-control ${#fields.hasErrors('commune.latitude') ? 'is-invalid' : 'is-valid'}|"-->
<!--                                   name="latitude"-->
<!--                                   id="latitude">-->
<!--                            <div class="invalid-feedback">-->
<!--                                <ul>-->
<!--                                    <li th:errors="${commune.latitude}"></li>-->
<!--                                </ul>-->
<!--                            </div>-->
<!--                        </div>-->


<!--                        <div>-->
<!--                            <div class="form-group">-->
<!--                                <label for="longitude">Longitude</label>-->

<!--                                <input type="text" th:value="${commune.longitude}" class="form-control is-valid"-->
<!--                                       name="longitude"-->
<!--                                       id="longitude">-->

<!--                            </div>-->
<!--                        </div>-->

                        <div th:replace="fragments/champs :: champLongitude"></div>

<!--                        <div class="form-group">-->
<!--                            <label for="longitude">Longitude</label>-->
<!--                            <input type="text" th:value="${commune.longitude}"-->
<!--                                   th:class="|form-control ${#fields.hasErrors('commune.longitude') ? 'is-invalid' : 'is-valid'}|"-->
<!--                                   name="longitude"-->
<!--                                   id="longitude">-->
<!--                            <div class="invalid-feedback">-->
<!--                                <ul>-->
<!--                                    <li th:errors="${commune.longitude}"></li>-->
<!--                                </ul>-->
<!--                            </div>-->
<!--                        </div>-->

                    </div>
                    <div class="col-sm-12 mt-2 text-center">

                    </div>

                    <div sec:authorize="hasRole('ADMIN')" class="col-sm-12 mt-2 text-center">
                        <input form="saveForm" class="btn btn-primary" type="submit" value="Enregistrer"/>
                        <!--                <a href="/communes/01009/delete" class="btn btn-danger">Supprimer</a>-->
                        <!--                        <a  th:if="${update}" href="/communes/CODEINSEE/delete" class="btn btn-danger">Supprimer</a>-->
                        <a th:if="${update}" th:href="@{|/communes/${codeInsee}/delete|}" class="btn btn-danger">Supprimer</a>
                        <!--                        <a  th:if="${update}" th:href="@{|/communes/${codeInsee}/delete" class="btn btn-danger|}">Supprimer</a>-->
                    </div>
                    <!--                    th:href="@{|/?page=${pageDown}&;search=&;size=&;sortDirection=&;sortProperty=|}">-->
                </form>
            </div>
            <!-- on n'affiche la carte que si on est en mode création -->
            <div th:if="${update}" class="col-lg-6">
                <!--            <div class="col-lg-6">-->
                <iframe width="650" height="450" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                        th:src="@{|https://www.openstreetmap.org/export/embed.html?bbox=${commune.longitude-0.10}%2C${commune.latitude-0.5}%2C${commune.longitude+0.10}%2C${commune.latitude+0.5}&layer=mapnik&marker=${commune.latitude}%2C${commune.longitude}|}"></iframe>
                <!--                th:src="@{|https://www.openstreetmap.org/export/embed.html?bbox=${longitude-0.10}%2C${latitude-0.5}%2C${longitude+0.10}%2C${latitude+0.5}&layer=mapnik&marker=${latitude}%2C${longitude}|}"></iframe>-->
                <!--                                        src="https://www.openstreetmap.org/export/embed.html?bbox=5.557883079240001%2C45.2873565333%2C5.75788307924%2C46.2873565333&amp;layer=mapnik&amp;marker=45.7873565333%2C5.65788307924" style="border: 1px solid black"></iframe>-->
            </div>


<!--            <div class="col-sm-12 text-center mt-2" th:unless="${newCommune}">-->
<!--                <form th:action="|/communes/${commune.codeInsee}|" method="get" class="form-inline mb-2"><input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->
<!--                    <label for="perimetre">Communes dans un périmètre de&nbsp;</label>-->
<!--                    <div class="input-group input-group-sm">-->
<!--                        <input type="number" name="perimetre" id="perimetre" class="form-control"-->
<!--                               th:value="${perimetre}">-->
<!--                        <div class="input-group-append">-->
<!--                            <span class="input-group-text">km</span>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <input class="btn btn-outline-primary btn-sm float-right" type="submit" value="Rechercher"/>-->
<!--                </form>-->
<!--            </div>-->

            <div class="col-sm-12 text-center mt-2" th:unless="${newCommune}">
                <form th:action="|/communes/${commune.codeInsee}|" method="get" class="form-inline mb-2"><input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <label for="perimetre">Communes dans un périmètre de&nbsp;</label>
                    <div class="input-group input-group-sm">
                        <input type="number" th:value="${perimetre}"
                               th:class="|form-control ${#fields.hasErrors('perimetre') ? 'is-invalid' : 'is-valid'}|"
                               name="perimetre"
                               id="perimetre">
                        <div class="input-group-append">
                            <span class="input-group-text">km</span>
                        </div>
                        <div class="input-group-append">
                            <ul>
                                <li th:errors="${perimetre}"></li>
                            </ul>
                        </div>
                    </div>
                    <input class="btn btn-outline-primary btn-sm float-right" type="submit" value="Rechercher"/>
<!--                    <span th:if="${perimetre} > 20">th:errors="Ceci est un test"</span>-->
                </form>
            </div>

            <div class="col-sm-6" th:unless="${newCommune}">
                <ul class="list-group">
                    <li class="list-group-item" th:each="communeProche : ${communesProches}">
                        <a th:href="|/communes/${communeProche.codeInsee}|">
                            [[${communeProche.nom}]] ([[${communeProche.codePostal}]])
                            <span class="badge badge-primary float-right">
                                [[${communeProche.getDistance(commune.latitude, commune.longitude)}]] km
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
            <!--            <div class="col-sm-12 text-center mt-2">-->
            <!--                    &lt;!&ndash; modifier périmètre &ndash;&gt;-->
            <!--&lt;!&ndash;                    <form action="/communes/01009" method="get" class="form-inline mb-2">&ndash;&gt;-->
            <!--                    <form th:action="|/communes/${commune.codeInsee}|" method="get" class="form-inline mb-2">-->
            <!--                    <label for="perimetre">Communes dans un périmètre de&nbsp;</label>-->
            <!--                    <div class="input-group input-group-sm">-->
            <!--&lt;!&ndash;                        <input type="number" name="perimetre" id="perimetre" class="form-control" value="10">&ndash;&gt;-->
            <!--                        <input type="number" name="perimetre" id="perimetre" class="form-control" th:value="${perimetre}">-->
            <!--                        <div class="input-group-append">-->
            <!--                            <span class="input-group-text">km</span>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                    <input class="btn btn-outline-primary btn-sm float-right" type="submit" value="Rechercher"/>-->
            <!--                </form>-->
            <!--            </div>-->
            <!--            <div class="col-sm-6">-->

            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01098">Chazey Bons (01510) <span class="badge badge-primary float-right">2 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01141">Cuzieu (01300) <span class="badge badge-primary float-right">4 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01227">Magnieu (01300) <span class="badge badge-primary float-right">5 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01234">Marignieu (01300) <span class="badge badge-primary float-right">5 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01162">Flaxieu (01350) <span class="badge badge-primary float-right">7 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01372">Saint Martin De Bavel (01510) <span class="badge badge-primary float-right">7 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01117">Conzieu (01300) <span class="badge badge-primary float-right">8 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01286">Parves Et Nattages (01300) <span class="badge badge-primary float-right">8 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01208">Lavours (01350) <span class="badge badge-primary float-right">9 km</span></a></li>-->
            <!--                </ul>-->
            <!--                <ul class="list-group">-->
            <!--                    <li class="list-group-item"><a href="/communes/01233">Marchamp (01680) <span class="badge badge-primary float-right">9 km</span></a></li>-->
            <!--                </ul>-->
            <!--            </div>-->

        </div>
    </div>
</div>

</body>
</html>